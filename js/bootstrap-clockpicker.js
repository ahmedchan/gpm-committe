!function(){var M,A=window.jQuery,o=A(window),T=A(document),i="http://www.w3.org/2000/svg",V="SVGAngle"in window&&((e=document.createElement("div")).innerHTML="<svg/>",t=(e.firstChild&&e.firstChild.namespaceURI)==i,e.innerHTML="",t),t="transition"in(e=document.createElement("div").style)||"WebkitTransition"in e||"MozTransition"in e||"msTransition"in e||"OTransition"in e,e="ontouchstart"in window,C="mousedown"+(e?" touchstart":""),P="mousemove.clockpicker"+(e?" touchmove.clockpicker":""),H="mouseup.clockpicker"+(e?" touchend.clockpicker":""),p=navigator.vibrate?"vibrate":navigator.webkitVibrate?"webkitVibrate":null;function x(t){return document.createElementNS(i,t)}function E(t){return(t<10?"0":"")+t}var S=0;var I=100,D=80,B=13,z=t?350:1,O=['<div class="popover clockpicker-popover">','<div class="arrow"></div>','<div class="popover-title">','<span class="clockpicker-span-hours text-primary"></span>'," : ",'<span class="clockpicker-span-minutes"></span>','<span class="clockpicker-span-am-pm"></span>',"</div>",'<div class="popover-content">','<div class="clockpicker-plate">','<div class="clockpicker-canvas"></div>','<div class="clockpicker-dial clockpicker-hours"></div>','<div class="clockpicker-dial clockpicker-minutes clockpicker-dial-out"></div>',"</div>",'<span class="clockpicker-am-pm-block">',"</span>","</div>","</div>"].join("");function c(t,l){var i,e,s=A(O),h=s.find(".clockpicker-plate"),o=s.find(".clockpicker-hours"),c=s.find(".clockpicker-minutes"),n=s.find(".clockpicker-am-pm-block"),a="INPUT"===t.prop("tagName"),r=a?t:t.find("input"),p=t.find(".input-group-addon"),u=this;this.id=(e=++S+"",(i="cp")?i+e:e),this.element=t,this.options=l,this.isAppended=!1,this.isShown=!1,this.currentView="hours",this.isInput=a,this.input=r,this.addon=p,this.popover=s,this.plate=h,this.hoursView=o,this.minutesView=c,this.amPmBlock=n,this.spanHours=s.find(".clockpicker-span-hours"),this.spanMinutes=s.find(".clockpicker-span-minutes"),this.spanAmPm=s.find(".clockpicker-span-am-pm"),this.amOrPm="PM",l.twelvehour&&(f=['<div class="clockpicker-am-pm-block">','<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-am-button">',"AM</button>",'<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-pm-button">',"PM</button>","</div>"].join(""),A(f),A('<button type="button" class="btn btn-sm btn-default clockpicker-button am-button">AM</button>').on("click",function(){u.amOrPm="AM",A(".clockpicker-span-am-pm").empty().append("AM")}).appendTo(this.amPmBlock),A('<button type="button" class="btn btn-sm btn-default clockpicker-button pm-button">PM</button>').on("click",function(){u.amOrPm="PM",A(".clockpicker-span-am-pm").empty().append("PM")}).appendTo(this.amPmBlock)),l.autoclose||A('<button type="button" class="btn btn-sm btn-default btn-block clockpicker-button">'+l.donetext+"</button>").click(A.proxy(this.done,this)).appendTo(s),"top"!==l.placement&&"bottom"!==l.placement||"top"!==l.align&&"bottom"!==l.align||(l.align="left"),"left"!==l.placement&&"right"!==l.placement||"left"!==l.align&&"right"!==l.align||(l.align="top"),s.addClass(l.placement),s.addClass("clockpicker-align-"+l.align),this.spanHours.click(A.proxy(this.toggleView,this,"hours")),this.spanMinutes.click(A.proxy(this.toggleView,this,"minutes")),r.on("focus.clockpicker click.clockpicker",A.proxy(this.show,this)),p.on("click.clockpicker",A.proxy(this.toggle,this));var k,d,f,m=A('<div class="clockpicker-tick"></div>');if(l.twelvehour)for(k=1;k<13;k+=1){var g=m.clone(),v=k/6*Math.PI,b=D;g.css("font-size","120%"),g.css({left:I+Math.sin(v)*b-B,top:I-Math.cos(v)*b-B}),g.html(0===k?"00":k),o.append(g),g.on(C,y)}else for(k=0;k<24;k+=1){g=m.clone(),v=k/6*Math.PI;var w=0<k&&k<13,b=w?54:D;g.css({left:I+Math.sin(v)*b-B,top:I-Math.cos(v)*b-B}),w&&g.css("font-size","120%"),g.html(0===k?"00":k),o.append(g),g.on(C,y)}for(k=0;k<60;k+=5)g=m.clone(),v=k/30*Math.PI,g.css({left:I+Math.sin(v)*D-B,top:I-Math.cos(v)*D-B}),g.css("font-size","120%"),g.html(E(k)),c.append(g),g.on(C,y);function y(t,s){var o,i=h.offset(),e=/^touch/.test(t.type),c=i.left+I,n=i.top+I,a=(e?t.originalEvent.touches[0]:t).pageX-c,r=(e?t.originalEvent.touches[0]:t).pageY-n,e=Math.sqrt(a*a+r*r),p=!1;s&&(e<67||93<e)||(t.preventDefault(),o=setTimeout(function(){M.addClass("clockpicker-moving")},200),V&&h.append(u.canvas),u.setHand(a,r,!s,!0),T.off(P).on(P,function(t){t.preventDefault();var i=/^touch/.test(t.type),e=(i?t.originalEvent.touches[0]:t).pageX-c,t=(i?t.originalEvent.touches[0]:t).pageY-n;!p&&e==a&&t==r||(p=!0,u.setHand(e,t,!1,!0))}),T.off(H).on(H,function(t){T.off(H),t.preventDefault();var i=/^touch/.test(t.type),e=(i?t.originalEvent.changedTouches[0]:t).pageX-c,t=(i?t.originalEvent.changedTouches[0]:t).pageY-n;(s||p)&&e==a&&t==r&&u.setHand(e,t),"hours"===u.currentView?u.toggleView("minutes",z/2):l.autoclose&&(u.minutesView.addClass("clockpicker-dial-out"),setTimeout(function(){u.done()},z/2)),h.prepend(d),clearTimeout(o),M.removeClass("clockpicker-moving"),T.off(P)}))}h.on(C,function(t){0===A(t.target).closest(".clockpicker-tick").length&&y(t,!0)}),V&&(d=s.find(".clockpicker-canvas"),(a=x("svg")).setAttribute("class","clockpicker-svg"),a.setAttribute("width",200),a.setAttribute("height",200),(n=x("g")).setAttribute("transform","translate(100,100)"),(f=x("circle")).setAttribute("class","clockpicker-canvas-bearing"),f.setAttribute("cx",0),f.setAttribute("cy",0),f.setAttribute("r",2),(r=x("line")).setAttribute("x1",0),r.setAttribute("y1",0),(p=x("circle")).setAttribute("class","clockpicker-canvas-bg"),p.setAttribute("r",B),(s=x("circle")).setAttribute("class","clockpicker-canvas-fg"),s.setAttribute("r",3.5),n.appendChild(r),n.appendChild(p),n.appendChild(s),n.appendChild(f),a.appendChild(n),d.append(a),this.hand=r,this.bg=p,this.fg=s,this.bearing=f,this.g=n,this.canvas=d)}c.DEFAULTS={default:"",fromnow:0,placement:"bottom",align:"left",donetext:"完成",autoclose:!1,twelvehour:!1,vibrate:!0},c.prototype.toggle=function(){this[this.isShown?"hide":"show"]()},c.prototype.locate=function(){var t=this.element,i=this.popover,e=t.offset(),s=t.outerWidth(),o=t.outerHeight(),c=this.options.placement,t=this.options.align,n={};switch(i.show(),c){case"bottom":n.top=e.top+o;break;case"right":n.left=e.left+s;break;case"top":n.top=e.top-i.outerHeight();break;case"left":n.left=e.left-i.outerWidth()}switch(t){case"left":n.left=e.left;break;case"right":n.left=e.left+s-i.outerWidth();break;case"top":n.top=e.top;break;case"bottom":n.top=e.top+o-i.outerHeight()}i.css(n)},c.prototype.show=function(t){var i,e,s;this.isShown||((i=this).isAppended||(M=A(document.body).append(this.popover),o.on("resize.clockpicker"+this.id,function(){i.isShown&&i.locate()}),this.isAppended=!0),"now"===(s=((this.input.prop("value")||this.options.default||"")+"").split(":"))[0]&&(s=[(e=new Date(+new Date+this.options.fromnow)).getHours(),e.getMinutes()]),this.hours=+s[0]||0,this.minutes=+s[1]||0,this.spanHours.html(E(this.hours)),this.spanMinutes.html(E(this.minutes)),this.toggleView("hours"),this.locate(),this.isShown=!0,T.on("click.clockpicker."+this.id+" focusin.clockpicker."+this.id,function(t){t=A(t.target);0===t.closest(i.popover).length&&0===t.closest(i.addon).length&&0===t.closest(i.input).length&&i.hide()}),T.on("keyup.clockpicker."+this.id,function(t){27===t.keyCode&&i.hide()}))},c.prototype.hide=function(){this.isShown=!1,T.off("click.clockpicker."+this.id+" focusin.clockpicker."+this.id),T.off("keyup.clockpicker."+this.id),this.popover.hide()},c.prototype.toggleView=function(t,i){var e="hours"===t,s=e?this.hoursView:this.minutesView,o=e?this.minutesView:this.hoursView;this.currentView=t,this.spanHours.toggleClass("text-primary",e),this.spanMinutes.toggleClass("text-primary",!e),o.addClass("clockpicker-dial-out"),s.css("visibility","visible").removeClass("clockpicker-dial-out"),this.resetClock(i),clearTimeout(this.toggleViewTimer),this.toggleViewTimer=setTimeout(function(){o.css("visibility","hidden")},z)},c.prototype.resetClock=function(t){var i=this.currentView,e=this[i],s="hours"===i,i=e*(Math.PI/(s?6:30)),e=s&&0<e&&e<13?54:D,o=Math.sin(i)*e,c=-Math.cos(i)*e,n=this;V&&t?(n.canvas.addClass("clockpicker-canvas-out"),setTimeout(function(){n.canvas.removeClass("clockpicker-canvas-out"),n.setHand(o,c)},t)):this.setHand(o,c)},c.prototype.setHand=function(t,i,e,s){var o,c=Math.atan2(t,-i),n="hours"===this.currentView,a=Math.PI/(n||e?6:30),r=Math.sqrt(t*t+i*i),t=this.options,i=n&&r<67,r=i?54:D;t.twelvehour&&(r=D),c<0&&(c=2*Math.PI+c),c=(o=Math.round(c/a))*a,t.twelvehour?n?0===o&&(o=12):(e&&(o*=5),60===o&&(o=0)):n?(12===o&&(o=0),o=i?0===o?12:o:0===o?0:o+12):(e&&(o*=5),60===o&&(o=0)),this[this.currentView]!==o&&p&&this.options.vibrate&&(this.vibrateTimer||(navigator[p](10),this.vibrateTimer=setTimeout(A.proxy(function(){this.vibrateTimer=null},this),100))),this[this.currentView]=o,this[n?"spanHours":"spanMinutes"].html(E(o)),V?(s||!n&&o%5?(this.g.insertBefore(this.hand,this.bearing),this.g.insertBefore(this.bg,this.fg),this.bg.setAttribute("class","clockpicker-canvas-bg clockpicker-canvas-bg-trans")):(this.g.insertBefore(this.hand,this.bg),this.g.insertBefore(this.fg,this.bg),this.bg.setAttribute("class","clockpicker-canvas-bg")),s=Math.sin(c)*r,r=-Math.cos(c)*r,this.hand.setAttribute("x2",s),this.hand.setAttribute("y2",r),this.bg.setAttribute("cx",s),this.bg.setAttribute("cy",r),this.fg.setAttribute("cx",s),this.fg.setAttribute("cy",r)):this[n?"hoursView":"minutesView"].find(".clockpicker-tick").each(function(){var t=A(this);t.toggleClass("active",o===+t.html())})},c.prototype.done=function(){this.hide();var t=this.input.prop("value"),i=E(this.hours)+":"+E(this.minutes);this.options.twelvehour&&(i+=this.amOrPm),this.input.prop("value",i),i!==t&&(this.input.triggerHandler("change"),this.isInput||this.element.trigger("change")),this.options.autoclose&&this.input.trigger("blur")},c.prototype.remove=function(){this.element.removeData("clockpicker"),this.input.off("focus.clockpicker click.clockpicker"),this.addon.off("click.clockpicker"),this.isShown&&this.hide(),this.isAppended&&(o.off("resize.clockpicker"+this.id),this.popover.remove())},A.fn.clockpicker=function(e){var s=Array.prototype.slice.call(arguments,1);return this.each(function(){var t=A(this),i=t.data("clockpicker");i?"function"==typeof i[e]&&i[e].apply(i,s):(i=A.extend({},c.DEFAULTS,t.data(),"object"==typeof e&&e),t.data("clockpicker",new c(t,i)))})}}();